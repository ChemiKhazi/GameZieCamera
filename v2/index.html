<html>
<head>
	<title>Game Zie Camera</title>
	<link rel="stylesheet" type="text/css" href="style.css" />
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
</head>

<body>

<div id="display">
	<video autoplay="true"></video>
	<canvas id="videoCanvas" width="128" height="128"></canvas>
</div>

<div id="controls">
<input type="button" value="Change Source" id="toggle-source" />
</div>

<div id="shaders">
	<script id="vtx" type="x-shader/x-vertex">
	varying vec2 vUv;
	void main() {
		vUv = uv;
	    gl_Position = projectionMatrix *
	                  modelViewMatrix *
	                  vec4(position,1.0);
	} 
	</script>

	<script id="frg" type="x-shader/x-fragment">
	uniform sampler2D baseTexture;
	uniform sampler2D ditherTexture;
	uniform vec2 resolution;
	varying vec2 vUv;

	void main() {
		// vec4 colour = texture2D( baseTexture, vUv );
		// int x = int(mod((vUv.x * resolution.x), 2.0));
		// int y = int(mod((vUv.y * resolution.y), 2.0));

		// // Set out 8x8 bayer matrix
		// int dither[8][8] = {
		// { 0, 32, 8, 40, 2, 34, 10, 42},
		// {48, 16, 56, 24, 50, 18, 58, 26},
		// {12, 44, 4, 36, 14, 46, 6, 38},
		// {60, 28, 52, 20, 62, 30, 54, 22},
		// { 3, 35, 11, 43, 1, 33, 9, 41},
		// {51, 19, 59, 27, 49, 17, 57, 25},
		// {15, 47, 7, 39, 13, 45, 5, 37},
		// {63, 31, 55, 23, 61, 29, 53, 21}
		// };

		// // Set our selection adjustment.
		// // In practice, higher numbers result in darker return colours
		// float selectionAdjustment = 128;
		// float limit = (dither[x][y]+1)/selectionAdjustment;

		// // Gamma adjustment
		// // Can alter individual colour channels if necessary
		// // For the gameboy palette, universal adjustment works well
		// float gammaAdjustmentR = 1.5;
		// float gammaAdjustmentG = 1.5;
		// float gammaAdjustmentB = 1.5;

		// // Adjust our final pixel colours, taking our threshold into consideration
		// colour.x = (colour.x + limit)/gammaAdjustmentR;
		// colour.y = (colour.y + limit)/gammaAdjustmentG;
		// colour.z = (colour.z + limit)/gammaAdjustmentB;
		// gl_FragColor = colour;

	    gl_FragColor = texture2D( baseTexture, vUv );
	}
	</script>
</div>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/three.js/r68/three.js"></script>

<script src="vidstream.js"></script>
<script src="camera.js"></script>
<script type="text/javascript">
	document.addEventListener('DOMContentLoaded', $VidStream.init, false);
	document.addEventListener('DOMContentLoaded', $GzCam.init, false);

	document.querySelector('#toggle-source').addEventListener('click', $VidStream.toggleStream, false);
</script>

</body>

</html>